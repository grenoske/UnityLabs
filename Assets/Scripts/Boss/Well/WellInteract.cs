using UnityEngine;

public class WellInteract : MonoBehaviour
{
    public float cooldownDuration = 5f; // ?????????? ???????? ? ????????
    public float healInterval = 0.5f; // ???????? ??? ?????? ?????? ????????? ? ????????
    public int healAmountPerInterval = 10; // ????????? HP, ??? ??????? ????????? ?? ??????? ?????
    public int maxHealAmount = 100; // ??????????? ????????? HP, ??? ??????? ???? ?????????
    public GameObject wellLight; // ?????? ????????

    public PlayerHealthManager playerHealthManager;

    private bool isOnCooldown = false; // ?????????, ?? ??????, ?? ???????? ??? ?? ????????
    private float cooldownTimer = 0f; // ?????? ????????
    private float healTimer = 0f; // ?????? ??? ??????????? ????????? ?????????
    private int totalHealAmount = 0; // ???????? ????????? ???????????? HP

    private void Update()
    {
        if (isOnCooldown)
        {
            cooldownTimer -= Time.deltaTime;

            if (cooldownTimer <= 0f)
            {
                isOnCooldown = false;
                wellLight.SetActive(true);
            }
        }

        if (totalHealAmount > 0)
        {
            healTimer -= Time.deltaTime;

            if (healTimer <= 0f)
            {
                playerHealthManager.RestorePlayerHealth(healAmountPerInterval);
                totalHealAmount -= healAmountPerInterval;

                if (totalHealAmount <= 0)
                {
                    totalHealAmount = 0;
                    wellLight.SetActive(false);
                }

                healTimer = healInterval;
            }
        }
    }

    private void OnTriggerEnter2D(Collider2D other)
    {
        if (other.CompareTag("Player") && !isOnCooldown && playerHealthManager.playerCurrentHealth < playerHealthManager.playerMaxHealth)
        {
            int missingHealth = playerHealthManager.playerMaxHealth - playerHealthManager.playerCurrentHealth;
            totalHealAmount = Mathf.Min(maxHealAmount, missingHealth);

            // ???????????? ????????
            isOnCooldown = true;
            cooldownTimer = cooldownDuration;

            healTimer = healInterval;

            // ??????? ????-??? ????????? ??????, ??? ?? ?????? ???????? ??? ????????? ? ?????????
        }
    }
}

